\chapter{Experiments}
\label{chapter:experiments}


\section{Full Lap Planning Test}

In this experiment we will test the Hybrid A* and \gls{SEHS} algorithms as we described them in Section~\ref{sec:trajectory_planning_algorithms} on several different circuit maps. For each circuit, their task will be to find a near time-optimal trajectory from a starting position through a series of waypoints until the last waypoint of the circuit is reached. We will then compare the quality of the solutions, how much of the state space the algorithm had to explore before it found the solution, and how long it took to calculate the result.

\subsection{Test Setup}

The parameters of the vehicle chassis and the vehicle model we used are equal to the properties of our experimental vehicle as stated in Table~\ref{table:dimensions} and derived in Section~\ref{sec:actuators_model}.

Both Hybrid A* and \gls*{SEHS} require specification of state space and time discretization parameters. We found that both algorithms performed well with time step $\Delta t=\SI{0.04}{\second}$ (\SI{25}{\hertz}), the heading angle values divided into \num{24} sectors of a circle, and the range of possible values of motor \gls*{RPM} divided into \num{50} sub-ranges. Additionally, the Hybrid A* algorithm splits the $x$ and $y$ coordinates were split into squares with side lengths of $4r$, where $r$ is the radius of the vehicle. The SEHS algorithm discretizes the $xy$ plane by finding a path of circles in the Space Exploration step. We require the radii of the circles to be between $r$ a $5r$.

The actions available to the planner were a cross product of 5 throttle levels (\num{-1}, \num{-0.5}, \num{0}, \num{0.5}, \num{1}) and 11 target steering angles (\num{-1}, \num{-0.8}, \num{-0.6}, \num{-0.4}, \num{-0.2}, \num{0}, \num{0.2}, \num{0.4}, \num{0.6}, \num{0.8}, \num{1}). This limits the possible maneuvers of the vehicle, but it allows the planner to run reasonably fast.

Circuits are represented by an occupancy grid bitmap with a resolution of \SI{0.05}{\meter} per grid cell. For each circuit, we first perform track segmentation, as described in Section~\ref{sec:track_segmentation}, to detect corners which we use as waypoints. We also perform the Space Exploration step of the SEHS algorithm. We then let both algorithms find the near time-optimal trajectory from the initial configuration defined for each circuit to the last waypoint. We measure the number of search nodes the algorithm opens during search, the number of search nodes which are expanded, and also the time it takes to find the solution on a testing computer. Because both of the algorithms are deterministic, they always find the same solution for the same problem and they always open and expand the same number of search nodes. The execution times differ slightly and so we repeat the measurement 100 times and calculate the mean execution time.

We used a desktop computer with an AMD Ryzen 7 3700X CPU running at the base clock of \SI{3.6}{\giga\hertz} and \SI{32}{\giga\byte} of DDR4 RAM at the base clock of \SI{3200}{\mega\hertz}. The source code was written in C++ and compiled using GCC 9.2 with the \texttt{-O3} and \texttt{-ffast-math} optimization flags. We ran each planning algorithm 50 times for every circuit to calculate the average computation time using our testing computer.

\subsection{Results}

The results of our experiments are shown in Figure~\ref{fig:porto},~\ref{fig:tornado},~\ref{fig:simple},~\ref{fig:u}, and~\ref{fig:zurich}.

Each figure shows the trajectory as a red curve from the initial configuration (marked with a green arrow) to a final configuration which passes the last waypoint (marked with a red waypoint). The black stars along the trajectory are a visual aid which marks the position of the vehicle every 1 second. The waypoints found by the track segmentation algorithm are marked as blue circles.

The trajectory is plotted over a map of the circuit with white parts showing the road and gray parts the boundaries of the track. As we mentioned earlier, the occupancy grids for the circuits all have resolution of \SI{0.05}{\meter}. Every \num{20} grid cells correspond to \SI{1}{\meter} in real world. Therefore for example the circuit in Figure~\ref{fig:zurich} represents an area of \SI{25}{\meter} $\times$ \SI{25}{\meter}.

Each trajectory is accompanied by three charts, showing the control inputs for the vehicle, the normalized state of the actuators, and the speed profile of the trajectory.

\todo[inline]{Add commentary for the results.}

\include{experiments_figures}

\section{Limited Lookahead Test}

In this test, we try to compare the performance of the algorithms for a shorter part of the track. For each track, we iterate over the corners we detected using the track segmentation algorithm and we use these corners as initial positions for the search algorithm and let it find a near-time optimal trajectory for the next two and three waypoints.

We want to determine if the algorithms are fast enough to find the following trajectories fast as the car is driving along the circuit. The setup for this test is the same as for the previous test.

\todo[inline]{This part is still not finished.}

\section{Real-World Test}

\todo[inline]{This part is still not finished.}