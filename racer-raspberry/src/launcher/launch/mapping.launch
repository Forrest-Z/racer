<launch>

  <node pkg="bno055_usb_stick" type="bno055_usb_stick_node" name="imu_node" output="screen">
    <param name="port" type="string" value="/dev/imu" />
    <param name="publish_tf" type="bool" value="true" />
    <param name="frame_id" type="string" value="odom_frame" />
  </node>

  <node name="sweep_node" pkg="sweep_ros" type="sweep_node" output="screen">
    <param name="serial_port" type="string" value="/dev/sweep"/>
    <param name="serial_baudrate" type="int" value="115200"/>
    <param name="frame_id" type="string" value="laser_frame"/>
    <param name="rotation_speed" type="int" value="10"/>
    <param name="sample_rate" type="int" value="1000"/>
  </node>

  <node pkg="pointcloud_to_laserscan" type="pointcloud_to_laserscan_node" name="pointcloud_to_laserscan">
    <remap from="cloud_in" to="pc2"/>
    <rosparam>
      target_frame: laser_frame
      transform_tolerance: 0.001
      min_height: -1.0
      max_height: 1.0
      angle_min: -3.14 # -M_PI/2
      angle_max: 3.14 # M_PI/2
      angle_increment: 0.001 # M_PI/360.0
      scan_time: 0.1
      range_min: 0.0
      range_max: 40.0
      use_inf: true

      # Concurrency level, affects number of pointclouds queued for processing and number of threads used
      # 0 : Detect number of cores
      # 1 : Single threaded
      # 2->inf : Parallelism level
      concurrency_level: 2
    </rosparam>
  </node>

  <node pkg="tf" type="static_transform_publisher" name="link1_broadcaster" args="1 0 0 0 0 0 base_link laser_frame 100" />

  <node pkg="hector_mapping" type="hector_mapping" name="hector_mapping" output="screen">
    <param name="scan_topic" value="scan" />
    <param name="base_frame" value="base_link" />
    <param name="odom_frame" value="base_link" />
    <param name="output_timing" value="false"/>
    <param name="advertise_map_service" value="true"/>
    <param name="use_tf_scan_transformation" value="true"/>
    <param name="use_tf_pose_start_estimate" value="false"/>
    <param name="pub_map_odom_transform" value="true"/>
    <param name="map_with_known_poses" value="false"/>
    <param name="map_pub_period" value="0.5"/>
    <param name="update_factor_free" value="0.45"/>
    <param name="map_update_distance_thresh" value="0.02"/>
    <param name="map_update_angle_thresh" value="0.1"/>
    <param name="map_resolution" value="0.1"/>
    <param name="map_size" value="512"/>
    <param name="map_start_x" value="0.5"/>
    <param name="map_start_y" value="0.5"/>
  </node>

</launch>
