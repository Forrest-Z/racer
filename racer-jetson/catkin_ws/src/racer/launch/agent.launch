<launch>
  <arg name="circuit" />
  <arg name="base_link_frame_id" default="base_link" />
  <arg name="origin_is_center_of_rear_axle" default="false" />
  <arg name="horizon" default="0.75" />
  <arg name="integration_step" default="0.02" />

  <group>
    <node pkg="racer" name="circuit_analysis" type="circuit_node" output="screen">
      <rosparam command="load" file="$(arg circuit)" />
      <param name="lookahead" value="3" />
    </node>

    <node pkg="racer" name="state" type="current_state_node" output="screen">
      <param name="frequency" value="25" />
      <param name="base_link_frame_id" value="$(arg base_link_frame_id)" />
      <param name="motor_rpm_topic" value="/racer/motor_rpm" />
      <param name="origin_is_center_of_rear_axle" value="$(arg origin_is_center_of_rear_axle)" />
    </node>

    <node pkg="racer" name="planning" type="planning_node" output="screen">
      <param name="map_topic" value="/obstacles/costmap/costmap" />
      <param name="normal_frequency" value="0.5" />
      <param name="max_frequency" value="10" />

      <param name="throttle_levels" value="7" />
      <param name="steering_levels" value="13" />

      <param name="min_throttle" value="-1.0" />
      <param name="max_throttle" value="1.0" />
      <param name="safety_margin" value="0.4" />

      <param name="time_step_s" value="$(arg integration_step)" />
    </node>

    <node pkg="racer" name="following" type="trajectory_following_node" output="screen">
      <param name="frequency" value="50" />
      <param name="ackermann_topic" value="/car_1/command" />

      <param name="strategy" value="pure_pursuit" />

      <!-- Pure pursuit -->
      <param name="min_lookahead" value="0.5" />
      <param name="max_lookahead" value="1.5" />
      <!-- -->

      <!-- DWA -->
      <param name="distance_to_obstacle_weight" value="500.0" />
      <param name="position_weight" value="200.0" />
      <param name="heading_weight" value="150.0" />
      <param name="velocity_weight" value="300.0" />

      <param name="prediction_horizon_s" value="$(arg horizon)" />
      <param name="integration_step_s" value="$(arg integration_step)" />
      <param name="throttle_levels" value="20" />
      <param name="steering_levels" value="31" />
      <param name="min_throttle" value="0.25" />
      <param name="max_throttle" value="0.85" />
      <!-- -->
    </node>
  </group>
</launch>